# GoCast Docker Compose Configuration
# Modern Icecast replacement written in Go

version: '3.8'

services:
  gocast:
    build:
      context: .
      dockerfile: Dockerfile
    image: gocast:latest
    container_name: gocast
    restart: unless-stopped
    ports:
      # HTTP streaming port
      - "8000:8000"
      # HTTPS streaming port (if SSL enabled)
      - "8443:8443"
    volumes:
      # Mount configuration file
      - ./gocast.vibe:/etc/gocast/gocast.vibe:ro
      # Mount logs directory (optional)
      - gocast-logs:/var/log/gocast
      # Mount SSL certificates (if using HTTPS)
      # - ./certs:/etc/gocast/ssl:ro
    environment:
      - TZ=UTC
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8000/"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
    networks:
      - gocast-network
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # Optional: Prometheus metrics exporter
  # Uncomment if you want to collect metrics
  # prometheus:
  #   image: prom/prometheus:latest
  #   container_name: gocast-prometheus
  #   restart: unless-stopped
  #   ports:
  #     - "9090:9090"
  #   volumes:
  #     - ./prometheus.yml:/etc/prometheus/prometheus.yml:ro
  #     - prometheus-data:/prometheus
  #   networks:
  #     - gocast-network

  # Optional: Grafana for visualization
  # Uncomment if you want dashboards
  # grafana:
  #   image: grafana/grafana:latest
  #   container_name: gocast-grafana
  #   restart: unless-stopped
  #   ports:
  #     - "3000:3000"
  #   volumes:
  #     - grafana-data:/var/lib/grafana
  #   environment:
  #     - GF_SECURITY_ADMIN_PASSWORD=admin
  #   networks:
  #     - gocast-network

volumes:
  gocast-logs:
    driver: local
  # prometheus-data:
  #   driver: local
  # grafana-data:
  #   driver: local

networks:
  gocast-network:
    driver: bridge
